# 定时播放

定时播放功能允许你在指定的精确时间自动开始播放，非常适合需要与其他玩家同步演奏的场景。

## 功能概述

定时播放基于 NTP（网络时间协议）实现精确时间同步，可以：

- 设置未来的播放时间点
- 自动倒计时并开始播放
- 多人同步播放（误差约 10-50ms）

## NTP 时间同步

### 什么是 NTP 同步？

NTP 同步从网络时间服务器获取精确时间，确保你的系统时间与标准时间一致。这对于多人同步演奏至关重要。

### 自动同步

程序启动时会自动进行 NTP 同步：
- 连接 NTP 服务器获取标准时间
- 计算本地时间与标准时间的偏差
- 后台定期刷新同步

### 同步状态

在界面底部可以看到 NTP 同步状态：
- 显示同步成功/失败
- 显示延迟和偏差信息

### 同步要求

- 需要网络连接
- NTP 使用 UDP 123 端口
- 防火墙需允许 NTP 流量

## 设置定时播放

### 步骤

1. **导入并配置** MIDI 文件和通道
2. **设置时间** 在定时区域输入分钟和秒数
3. **点击设置定时** 开始倒计时
4. **等待自动播放** 到达设定时间自动开始

### 时间格式

- 分钟：0-59
- 秒：0-59

设置的是距离现在的相对时间。例如：
- 设置 1 分 30 秒 = 90 秒后开始播放

### 取消定时

在定时状态下：
- 点击「停止」按钮取消定时
- 或再次点击「设置定时」取消

## 使用场景

### 多人同步演奏

1. 玩家约定播放时间（例如 1 分钟后）
2. 所有人同时设置相同的定时
3. 到达时间后所有人同时开始

### 精确时间点演奏

1. 计算需要开始播放的具体时间
2. 提前设置定时
3. 程序在指定时间自动开始

## 注意事项

### 时间精度

- NTP 同步精度通常在 10-50ms
- 网络延迟会影响精度
- 建议使用稳定的网络环境

### 准备工作

定时播放前确保：
- MIDI 文件已正确加载
- 通道配置正确
- 目标窗口已打开
- 键位映射正确

### 取消后重新设置

取消定时后可以重新设置新的定时时间。

## 技术细节

### NTP 服务器

程序使用公共 NTP 服务器池：
- pool.ntp.org
- 自动选择延迟最低的服务器

### 时间计算

```
播放时间 = 当前 NTP 时间 + 设定的等待时间
```

程序使用高精度计时器确保在正确的时间触发播放。
