# 高级功能

本文档介绍 GO_MIDI! 的高级功能，包括变速播放、和弦分解、延迟补偿等。

## 变速播放

### 调整播放速度

在播放控制区域可以调整播放速度：

- 默认速度：1.00x（原速）
- 调整范围：0.25x - 4.00x
- 调整方式：点击微调按钮或直接输入数值

### 速度与音高

变速播放**不会改变音高**，只是改变播放速度：
- 速度 > 1.00：快速播放，音符间隔缩短
- 速度 < 1.00：慢速播放，音符间隔延长

### 使用场景

1. **练习模式**：降低速度慢速练习
2. **快速演奏**：提高速度增加演奏难度
3. **时间适配**：调整演奏时长适应特定场景

## 和弦分解

### 什么是和弦分解？

当多个音符同时触发时（和弦），键盘无法同时按下多个键。和弦分解功能会将同时的音符按极短间隔依次触发。

### 启用/禁用

点击「和弦分解」按钮切换状态：
- 按下状态：启用和弦分解
- 弹起状态：禁用（同时音符可能丢失）

### 工作原理

启用后，同时的音符会：
1. 按音高排序
2. 以极短间隔（约 1-5ms）依次触发
3. 确保所有音符都能被演奏

### 建议设置

- **推荐启用**：大多数情况建议开启
- **可禁用**：如果 MIDI 文件本身音符错开良好

## 延迟补偿

### 什么是延迟补偿？

延迟补偿用于抵消系统延迟，使按键时机更精确。

### 设置延迟补偿

在状态栏可以看到延迟补偿输入框：
- 单位：毫秒（ms）
- 正值：延迟发送按键
- 负值：提前发送按键

### 使用场景

1. **游戏延迟**：如果游戏有输入延迟，设置正值补偿
2. **音频延迟**：配合音频输出时可能需要调整
3. **网络延迟**：多人同步时可能需要微调

### 调整方法

1. 播放一段熟悉的 MIDI
2. 观察按键与游戏反应的时间差
3. 调整补偿值直到同步

## 音高范围

### 设置音高范围

在播放控制区域设置音高范围：
- **最低音高**：MIDI 编号，默认 48 (C3)
- **最高音高**：MIDI 编号，默认 84 (C6)

### 作用

- 超出范围的音符会被忽略
- 配合智能移调优化音符分布

### 调整建议

根据键位映射覆盖范围设置：
- 如果键位映射覆盖 C3-B5，设置 48-83
- 避免设置过大的范围

## 智能移调

### 自动计算

程序会自动计算最佳移调：

1. 分析音轨中音符的分布
2. 计算键位映射覆盖的范围
3. 找到让最多音符落在可用范围内的移调值

### 手动微调

智能移调后，仍可手动微调：
- 在通道配置中设置移调值
- 手动设置会叠加到智能移调结果上

## 配置持久化

### 自动保存

以下配置会自动保存：

| 配置 | 保存位置 |
|------|----------|
| 通道配置 | config.ini |
| 播放列表 | playlist.ini |
| 键位映射 | keymap.txt |
| 全局设置 | global.ini |

### 配置文件位置

所有配置文件位于程序同目录。

### 迁移配置

更换程序版本时：
1. 备份配置文件
2. 复制到新版本目录
3. 或使用「加载键位」手动加载

## 性能优化

### 大型 MIDI 文件

对于音符数量很多的 MIDI 文件：
- 程序使用内存池优化内存分配
- 支持平滑的进度拖动

### 低延迟模式

程序优化了按键发送时机：
- 使用高精度定时器
- 最小化处理延迟

### 多线程

播放引擎使用独立线程：
- 不阻塞 UI 界面
- 支持后台播放
